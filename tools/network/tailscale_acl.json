{
  // Tailscale ACL (Access Control List) for Agrobot TOM v2
  //
  // This file is pasted into: https://login.tailscale.com/admin/acls
  //
  // Design principles:
  //   1. Principle of least privilege — nodes only expose the ports they need.
  //   2. Tag-based rules — we use tags (not IP addresses) so the policy
  //      remains valid even when a machine is replaced or its IP changes.
  //   3. ROS 2 DDS ports are explicitly enumerated — DDS uses a range of
  //      ephemeral ports; we open the standard range for our domain ID.
  //
  // ROS 2 DDS Port Calculation (for ROS_DOMAIN_ID=42):
  //   Discovery server port  = 7400 + (250 * domain_id) + 0  = 17900
  //   User traffic base      = 7400 + (250 * domain_id) + 1  = 17901
  //   Ephemeral range        = 32768–60999 (Linux default)
  //   We open 17900-17910 for DDS discovery + a unicast data range.

  // ── NETWORK TOPOLOGY NOTE ─────────────────────────────────────────────────
  // NYU HPC Greene is accessed via Cisco AnyConnect VPN (NYU-NET).
  // AnyConnect is hub-and-spoke and conflicts with Tailscale's WireGuard UDP.
  // Greene compute nodes also have no direct internet egress.
  //
  // RESULT: HPC is NOT on the Tailscale mesh. It is accessed exclusively via:
  //   - SSH over AnyConnect VPN (interactive)
  //   - scp/rsync over AnyConnect (model artifact transfer)
  //
  // Only local Mac ↔ AMD Edge require Tailscale (for live ROS 2 DDS).
  // ──────────────────────────────────────────────────────────────────────────

  "tagOwners": {
    "tag:dev":      ["autogroup:owner"],  // local Mac (AI/Systems engineer machine)
    "tag:robot":    ["autogroup:owner"],  // AMD edge robot computer
    "tag:ci":       ["autogroup:owner"]   // Future: CI/CD runner
    // tag:hpc intentionally omitted — HPC uses AnyConnect, not Tailscale
  },

  "acls": [
    // ── Dev machine (local Mac) → Robot: SSH + Foxglove Studio ────────────
    // Ports are embedded in dst as "tag:22" — the current Tailscale format.
    // 22   = SSH
    // 9090 = rosbridge_websocket (Foxglove Studio visualization)
    {
      "action": "accept",
      "src":    ["tag:dev"],
      "dst":    ["tag:robot:22", "tag:robot:9090"]
    },

    // ── ROS 2 DDS — Dev ↔ Robot (bidirectional, UDP + TCP) ────────────────
    // Port range 17900-17910: FastDDS discovery for ROS_DOMAIN_ID=42
    //   Formula: 7400 + (250 × 42) = 17900
    // Port range 7400-7500: standard DDS data traffic range
    {
      "action": "accept",
      "src":    ["tag:dev", "tag:robot"],
      "dst":    ["tag:dev:17900-17910", "tag:dev:7400-7500",
                 "tag:robot:17900-17910", "tag:robot:7400-7500"]
    },

    // ── Self-access (loopback equivalence) ────────────────────────────────
    {
      "action": "accept",
      "src":    ["autogroup:member"],
      "dst":    ["autogroup:self:*"]
    }
  ],

  // MagicDNS is configured in the Tailscale admin panel → DNS tab (not in this file).
  // Recommended machine names to set via Machines → Edit name:
  //   local-mac  → the AI/Systems engineer's development machine
  //   amd-edge   → the AMD 96GB robot computer

  "ssh": [
    // Allow SSH via Tailscale SSH (no separate key management needed).
    // Only tag:dev → tag:robot — HPC is NOT on Tailscale (uses AnyConnect VPN).
    {
      "action": "accept",
      "src":    ["tag:dev"],
      "dst":    ["tag:robot"],
      "users":  ["autogroup:nonroot"]
    }
  ]
}
